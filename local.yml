---
#
- hosts: localhost

  tasks:
  
  - name: create required directories
    file: path={{ item }} state=directory
    with_items:
    - "{{ ansible_env.HOME }}/src"
    - "{{ ansible_env.HOME }}/bin"
    - "{{ ansible_env.HOME }}/work"

  - name: create directory and files for hg requirement
    raw: |
      mkdir -p {{ ansible_env.HOME }}/Library/Python/2.7/lib/python/site-packages; 
      echo 'import site; site.addsitedir("/usr/local/lib/python2.7/site-packages")' > {{ ansible_env.HOME }}/Library/Python/2.7/lib/python/site-packages/homebrew.pth

  - name: check homebrew installation
    command: test -e /usr/local/bin/brew
    register: homebrew_installed
    ignore_errors: yes

  - name: install homebrew 
    raw: ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" 
    when: homebrew_installed|failed   

  - name: update homebrew
    homebrew: update_homebrew=yes upgrade_all=yes

  - name: add homebrew repositories
    homebrew_tap: tap={{ item }} state=present
    with_items:
    - homebrew/dupes
    - caskroom/cask
    - homebrew/versions
    - caskroom/versions
    - peco/peco
    - motemen/ghq

  - name: install packages
    homebrew: name={{ item }} state=latest
    with_items:
    - direnv
    - pt
    - brew-cask
    - jq
    - tmux
    - docker
    - boot2docker
    - vim
    - zsh
    - git
    - peco
    - ghq
    - ttyrec
    - imagemagick
    - hub

  # run etc/init-openssh.yml to reconfigure and restart daemons
  - name: install openssh package
    homebrew: name=openssh state=latest
              install_options=with-keychain-support

  - name: install cask packages
    homebrew_cask: name={{ item }}
    with_items:
    - google-chrome
    - dropbox
    - 1password
    - alfred
    - pivotalbooster
    - amethyst
    - shortcat
    - intellij-idea
    - java6
    - java7
    - java
    - iterm2
    - teleport
    - authy-bluetooth
    - karabiner
    - seil
    - xtrafinder
  
  - name: install zprezto
    git: repo=https://github.com/sorin-ionescu/prezto dest={{ ansible_env.HOME }}/.zprezto
 
  - name: to be enabled zprezto
    file: src={{ ansible_env.HOME }}/.zprezto/runcoms/{{ item }} dest={{ ansible_env.HOME }}/.{{ item | basename }} state=link
    with_fileglob:
    - "{{ ansible_env.HOME }}/.zprrezto/runcoms/z*"

  - name: locate dot-files
    file: src={{ item }} dest={{ ansible_env.HOME }}/.{{ item | basename }} state=link
    with_fileglob:
    - dots/*

